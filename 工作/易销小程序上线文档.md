## 前言
#### Tip：看不到图片请用非谷歌浏览器打开（360或qq浏览器）
为了让大家熟悉上线流程，避免自己上线的时候，遗漏部分操作。先总结一份完整的小程序上线文档，如果后续流程有变，应及时更新这个文档。
#### 流程包括以下几个部分
- 资源图片上传
- 代码编译
- 提交审核，发布
- 更新第三方模板
- 上线分支合并
- ![image](https://raw.githubusercontent.com/waldonUB/gc-base/master/image/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201214101315.jpg)
## 上线流程
### 1. tsapp资源图片上传
- 在版本上线前(周一或周二)，将本地未提交的图片资源统一更新到dep
### 2. 代码编译
- 版本上线只在pre分支操作，周三早上确认所有人代码已提交到pre（上版本补上线的代码也可以确认下）
- 确认diffModule目录有无代码更新，特别是直销的
![image](https://user-images.githubusercontent.com/30494925/106569117-1f8c5d80-656f-11eb-84f4-3bfec0f66f91.png)
- 确认当前版本有无新增新的娱乐类目，如视频等。如果有的话需针对审核账号隐藏该功能的入口，否则会导致审核不通过
- **将版本号改为当前版本上线日期，这个是后端接口做兼容性用的。**
![image](https://user-images.githubusercontent.com/30494925/106569182-2e731000-656f-11eb-9f1e-c50c5b2a8ae9.png)
- 拉完代码后先自己build一遍，避免依赖报错之类的问题导致延误上线时间
- 等后端在开发群通知前端提审小程序代码的时候，把build好的pro环境的代码上传到对应的直分销的体验版（dep和线上是同一个小程序）。需注意请求接口的域名是否为线上地址，确认无误后再上传
![image](https://user-images.githubusercontent.com/30494925/106569220-3a5ed200-656f-11eb-816c-bfa137680d6c.png)
![image](https://user-images.githubusercontent.com/30494925/106568568-6b8ad280-656e-11eb-950e-49aa679b4b68.png)
### 3. 提交审核，发布
- **提审前，先登录直分销对应的审核账号（wxAudit1001）**，查看基本流程有无问题，除**文章**和**名片**外，其他模块是否有屏蔽掉入口
- 将上传好的对应版本设为体验版，给测试测兼容性，并开始提审
- 在测试反馈群艾特测试组长
- 提审除了描述，其他的不用修改
![image](https://user-images.githubusercontent.com/30494925/106568716-9d039e00-656e-11eb-843f-6383cb1cab97.png)
- 简单点点各个模块，看看有无明显的报错。退出账号点击一下直销的登录，看一下是否正常
- 提审操作应在早上11点左右完成，避免影响测试。待测试兼容性完成后，如果小程序已审核通过，午休后直接发布，然后群里通知一声即可
### 4. 更新第三方模板
- 发布小程序1小时后，如果没有问题，就开始准备提交第三方模板
- 提交时，无需重新执行命令编译，找到dist\build目录下的ext.json，将extAppid改为对应的直分销第三方appid
    - 分销：wxee6ed184ebd1cca6
    - 直销：wx5cc24a57a992274b
![image](https://user-images.githubusercontent.com/30494925/106568771-abea5080-656e-11eb-9784-a0001aa7255f.png)
- 改完后，小程序也会自动编译代码，这里的appid也需同步修改
![image](https://user-images.githubusercontent.com/30494925/106568818-c0c6e400-656e-11eb-90ee-266487dd7482.png)
- 接着登录开发平台对应的账号
    - 分销：wx124@faisco.com 密码：dev@fai508-ts
    - 直销：wx183@faisco.com 密码：faisco@508
    - 开放平台地址：https://open.weixin.qq.com/
- 将提交好的草稿模板加入模板库，并记住对应的templateId
![image](https://user-images.githubusercontent.com/30494925/106568886-da682b80-656e-11eb-9137-f14bdb615f92.png)
![image](https://user-images.githubusercontent.com/30494925/106568927-e7851a80-656e-11eb-8375-dfe43df3996e.png)
![image](https://user-images.githubusercontent.com/30494925/106568972-f5d33680-656e-11eb-8953-d83004ebb047.png)
- 登录配置中心 https://config.faisco.biz/ ，修改对应的模板id并发布，发布完成后在群里通知一声
![image](https://user-images.githubusercontent.com/30494925/106569017-01266200-656f-11eb-9720-d044fed77347.png)
- 如果提交的模板有问题，比如视频、海报入口没有屏蔽，依赖其他插件导致提审失败或小程序有严重问题时，应及时回滚模板，并模板库有问题的模板删掉
![image](https://user-images.githubusercontent.com/30494925/106835249-f46e4f00-66d1-11eb-8ec7-a220dc3c236f.png)
![image](https://user-images.githubusercontent.com/30494925/106835664-b0c81500-66d2-11eb-912e-b3ec3bdc4f50.png)
- 以上账号均可在账号库复制最新内容，https://docs.qq.com/sheet/DTlFLQkRnR0NVVWZW?tab=BB08J5
### 5. 合并分支
- 版本上线完后的第二天，在群里同步合并分支的消息，并把pre的代码合并到pro分支