<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>游戏全景</title>
  <link href="http://admin.static.37wan.com/adminfront/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .g6-tooltip {
      display: flex;
      justify-content: center;
      box-sizing: border-box;
      align-items: center;
      border: 1px solid #e2e2e2;
      border-radius: 4px;
      font-size: 12px;
      color: #545454;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 10px 15px;
      box-shadow: rgb(174 174 174) 0px 0px 10px;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <script src="http://admin.static.37wan.com/adminfront/js/jquery.min.js"></script>
  <script src="http://admin.static.37wan.com/adminfront/js/bootstrap.min.js"></script>
  <!-- <script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.8.0/dist/g6.min.js"></script> -->
  <script src="http://adminedition.37wan.com/static/js/g6.min.js"></script>
  <script src="./mock/org.js"></script>
  <script>
  const data = org.val

  /**
   * 组织架构label换行
   * @author waldon
   * @date 2023-01-10
   */
  const getOrgLabel = (str) => {
    const NODE_LENGTH = 3
    if (str?.length > NODE_LENGTH) {
      const ORG_LENGTH = 2 // 组织架构的默认长度
      const strArr = str.split('')
      strArr.splice(ORG_LENGTH, 0, '\n')
      return strArr.join('')
    }
    return str
  }

  const tooltip = new G6.Tooltip({
    offsetX: 10,
    offsetY: 10,
    className: 'g6-tooltip',
    getContent(e) {
      const outDiv = document.createElement('div');
      outDiv.innerHTML = `<div>${e.item.getModel().label}</div>`
      return outDiv
    },
    itemTypes: ['node'],
    fixToNode: [0.5, 0.5]
  });

  setTimeout(() => {
    const container = document.getElementById('container');
    const width = container.scrollWidth;
    const height = container.scrollHeight || 800;
    const graph = new G6.TreeGraph({
      container: 'container',
      width,
      height,
      linkCenter: true,
      plugins: [tooltip], // 配置 Grid 插件和 Minimap 插件
      modes: {
        default: [
          {
            type: 'collapse-expand',
            onChange: function onChange(item, collapsed) {
              const data = item.get('model');
              data.collapsed = collapsed;
              return true;
            },
          },
          'drag-canvas',
          'zoom-canvas',
        ],
      },
      defaultNode: {
        size: 42,
        style: {
          cursor: 'pointer'
        },
      },
      layout: {
        type: 'dendrogram',
        direction: 'LR',
        nodeSep: 20,
        rankSep: 120,
        radial: true,
      },
    });

    graph.node(function (node) {
      const { type, name } = node
      const nodeStyle = {}
      let label = name
      if (type === 1) {
        nodeStyle.fill = '#ff9925'
        nodeStyle.stroke = '#ff9925'
        label = getOrgLabel(name)
      }
      return {
        label,
        labelCfg: {
          style: {
            cursor: 'pointer',
          },
        },
        style: nodeStyle,
      };
    });

    graph.on('node:click', (ev) => {
      const shape = ev.target;
      const node = ev.item;
      console.log(`shape`, shape);
      console.log(`node`, node);
    });

    graph.data(data);
    graph.render();
    graph.fitView();

    if (typeof window !== 'undefined')
    window.onresize = () => {
      if (!graph || graph.get('destroyed')) return;
      if (!container || !container.scrollWidth || !container.scrollHeight) return;
      graph.changeSize(container.scrollWidth, container.scrollHeight);
    };
  }, 0)
  </script>
</body>
</html>
